{% extends 'member/member_base.html.twig' %}

{% block template %}
    {% embed 'member/member_base_layouts/member_base_free_grid.html.twig' %}
        {% block midle %}
            <div style="height:100%;width:100%;" 
                 data-controller="invtation-list" 
                 data-invtation-list-base-url-value="{{ path('app_member_invitation_list') }}">
                
                <div class="messenger-container" style="max-width: 100%; min-width: 100%; max-height: 100%; min-height: 100%; margin: 0 auto; height: 600px; display: flex; flex-direction: column; background: #23272b; border-radius: 12px; box-shadow: 0 2px 12px rgba(0,0,0,0.15);">
                    
                    <!-- Header with Create Button -->
                    <div class="messenger-header" style="padding: 1.5rem; border-bottom: 1px solid #333; display: flex; align-items: center; justify-content: space-between;">
                        <div style="display: flex; align-items: center;">
                            <div style="font-size: 2rem; margin-right: 0.75rem;">üìú</div>
                            <div>
                                <h2 style="margin: 0; color: #fff;">Member Invitations</h2>
                                <p style="margin: 0.25rem 0 0 0; color: #aaa;">Manage your invitations</p>
                            </div>
                        </div>
                        <a href="{{ path('app_member_create_invitation') }}" class="button-6" style="padding: 0.75rem 1.5rem; font-size: 1rem; background: #4caf50; display: flex; align-items: center; gap: 0.5rem; text-decoration: none;">
                            <span>‚ú®</span>Create Invitation
                        </a>
                    </div>

                    <!-- Stats Overview -->
                    <div style="padding: 1.5rem; border-bottom: 1px solid #333;">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
                            <div style="background: #2c3136; border-radius: 8px; padding: 1rem; text-align: center; border-left: 4px solid #f39c12;">
                                <div style="color: #f39c12; font-size: 1.3rem; font-weight: bold;">{{ totalPending|default(0) }}</div>
                                <div style="color: #aaa; font-size: 0.85em;">Pending</div>
                            </div>
                            <div style="background: #2c3136; border-radius: 8px; padding: 1rem; text-align: center; border-left: 4px solid #e74c3c;">
                                <div style="color: #e74c3c; font-size: 1.3rem; font-weight: bold;">{{ totalExpired|default(0) }}</div>
                                <div style="color: #aaa; font-size: 0.85em;">Expired</div>
                            </div>
                        </div>
                    </div>

                    <!-- Filter and Search -->
                    <div style="padding: 1rem 1.5rem; border-bottom: 1px solid #333; display: flex; gap: 1rem; align-items: center;">
                        <div style="flex: 1;">
                            <input type="text" 
                                   placeholder="Search by email or username..." 
                                   data-invtation-list-target="searchInput"
                                   style="width: 100%; padding: 0.5rem 0.75rem; border-radius: 6px; border: 1px solid #555; background: #1a1d21; color: #fff; font-size: 0.9rem;">
                        </div>
                        <select data-invtation-list-target="statusSelect" 
                                style="padding: 0.5rem; border-radius: 6px; border: 1px solid #555; background: #1a1d21; color: #fff;">
                            <option value="">All Status</option>
                            <option value="pending">Pending</option>
                            <option value="accepted">Accepted</option>
                            <option value="expired">Expired</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                        <button class="button-6" 
                                data-action="click->invtation-list#applyFilters"
                                style="padding: 0.5rem 1rem; font-size: 0.9rem; background: #6c757d;">
                            üîç Filter
                        </button>
                        <button class="button-6" 
                                data-action="click->invtation-list#clearFilters"
                                style="padding: 0.5rem 1rem; font-size: 0.9rem; background: #dc3545;">
                            üóëÔ∏è Clear
                        </button>
                    </div>

                    <!-- Invitations List -->
                    <div style="flex: 1; overflow-y: auto; padding: 1rem;">
                        {% if invitations is defined and invitations|length > 0 %}
                            <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                                {% for invitation in invitations %}
                                    <div data-invtation-list-target="invitationItem"
                                         data-email="{{ invitation.email }}"
                                         data-username="{{ invitation.username|default('') }}"
                                         data-status="{{ invitation.status }}"
                                         style="background: #2c3136; border-radius: 8px; padding: 1.25rem; border-left: 4px solid {% if invitation.status == 'pending' %}#f39c12{% elseif invitation.status == 'accepted' %}#4caf50{% elseif invitation.status == 'expired' %}#e74c3c{% else %}#6c757d{% endif %};">
                                        
                                        <div style="display: flex; justify-content: space-between; align-items: start;">
                                            <!-- Left: Invitation Details -->
                                            <div style="flex: 1;">
                                                <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                                                    <div style="font-size: 1.2rem;">
                                                        {% if invitation.status == 'pending' %}‚è≥
                                                        {% elseif invitation.status == 'accepted' %}‚úÖ
                                                        {% elseif invitation.status == 'expired' %}‚ùå
                                                        {% else %}üö´{% endif %}
                                                    </div>
                                                    <div>
                                                        <h4 style="margin: 0; color: #fff; font-size: 1.1rem;">{{ invitation.email }}</h4>
                                                    </div>
                                                </div>

                                                <div style="display: flex; gap: 1.5rem; margin-top: 0.75rem; font-size: 0.85em; color: #aaa;">
                                                    <span><strong>Sent:</strong> {{ invitation.createdAt|date('M j, Y H:i') }}</span>
                                                    <span><strong>Expires:</strong> {{ 'todo implement' }}</span>
                                                    {% if invitation.status == 'accepted' %}
                                                        <span style="color: #4caf50;">ACCEPTED</span>
                                                    {% endif %}
                                                </div>
                                            </div>

                                            <!-- Right: Action Buttons -->
                                            <div style="display: flex; gap: 0.5rem; justify-content: space-around;">
                                                {% if invitation.status == 'pending' %}
                                                    <button class="button-6" 
                                                            data-action="click->invtation-list#copyLink"
                                                            data-token="{{ invitation.secretTag }}">
                                                        üìã Copy Link
                                                    </button>
                                                    <button class="button-6"
                                                            data-action="click->invtation-list#resendInvitation"
                                                            data-invitation-id="{{ invitation.id }}">
                                                        üì§ Resend
                                                    </button>
                                                    <button class="button-6"
                                                            data-action="click->invtation-list#cancelInvitation"
                                                            data-invitation-id="{{ invitation.id }}">
                                                        ‚ùå Cancel
                                                    </button>
                                                {% elseif invitation.status == 'expired' %}
                                                    <button class="button-6"
                                                            data-action="click->invtation-list#renewInvitation"
                                                            data-invitation-id="{{ invitation.id }}">
                                                        üîÑ Renew
                                                    </button>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <!-- Empty State -->
                            <div style="text-align: center; padding: 3rem; color: #aaa;">
                                <div style="font-size: 3rem; margin-bottom: 1rem;">üì≠</div>
                                <h3 style="color: #fff; margin-bottom: 0.5rem;">No Invitations Yet</h3>
                                <p style="margin-bottom: 1.5rem;">Start building your guild by inviting fellow adventurers!</p>
                                <a href="{{ path('app_member_create_invitation') }}" class="button-6" style="padding: 0.75rem 2rem; font-size: 1.1rem; background: #4caf50; text-decoration: none; display: inline-flex; align-items: center; gap: 0.5rem;">
                                    <span>‚ú®</span>Create Your First Invitation
                                </a>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        {% endblock %}
    {% endembed %}
{% endblock %}